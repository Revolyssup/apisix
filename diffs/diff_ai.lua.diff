20a21
> local get_global_rules = require("apisix.global_rules").global_rules
71,73c72
<     return core.table.deepcopy(api_ctx, {
<         shallows = { "self.matched_route.value.upstream.parent" }
<     })
---
>     return core.table.deepcopy(api_ctx)
167a167
> 
233,234c233,234
<     local global_rules_flag = router.global_rules and router.global_rules.values
<                               and #router.global_rules.values ~= 0
---
>     local global_rules, _ = get_global_rules()
>     local global_rules_flag = global_rules and #global_rules ~= 0
