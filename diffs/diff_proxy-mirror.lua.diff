30c30
<             pattern = [=[^http(s)?:\/\/([\da-zA-Z.-]+|\[[\da-fA-F:]+\])(:\d+)?$]=],
---
>             pattern = [=[^(http(s)?|grpc(s)?):\/\/([\da-zA-Z.-]+|\[[\da-fA-F:]+\])(:\d+)?$]=],
79c79
<             return prop_host
---
>             return url_decoded.scheme, prop_host
85c85
<         return host
---
>         return url_decoded.scheme, host
87c87
<     return prop_host
---
>     return url_decoded.scheme, prop_host
104c104,106
<     ctx.var.upstream_mirror_uri = resolver_host(conf.host) .. uri
---
>     local _, mirror_host = resolver_host(conf.host)
>     ctx.var.upstream_mirror_host = mirror_host
>     ctx.var.upstream_mirror_uri = mirror_host .. uri
116a119
>         ctx.enable_mirror = true
122a126
>             ctx.enable_mirror = true
