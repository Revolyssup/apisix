20,22d19
< local type = type
< local ipairs = ipairs
< local plugin = require("apisix.plugin")
53c50
<             local auth = plugin.get(auth_plugin_name)
---
>             local auth = require("apisix.plugins." .. auth_plugin_name)
55a53,60
>             else
>                 if auth.type ~= 'auth' then
>                     return false, auth_plugin_name .. " plugin is not supported"
>                 end
>                 local ok, err = auth.check_schema(auth_plugin_conf, auth.schema)
>                 if not ok then
>                     return false, "plugin " .. auth_plugin_name .. " check schema failed: " .. err
>                 end
57,64d61
<             if auth.type ~= 'auth' then
<                 return false, auth_plugin_name .. " plugin is not supported"
<             end
<             local ok, err = auth.check_schema(auth_plugin_conf)
<             if not ok then
<                 return false, "multi-auth plugin failed to check the configuration of plugin "
<                     .. auth_plugin_name .. " err: " .. err
<             end
74d70
<     local errors = {}
77c73
<             local auth = plugin.get(auth_plugin_name)
---
>             local auth = require("apisix.plugins." .. auth_plugin_name)
79,83c75
<             local auth_code, err = auth.rewrite(auth_plugin_conf, ctx)
<             if type(err) == "table" then
<                 err = err.message  -- compat
<             end
< 
---
>             local auth_code = auth.rewrite(auth_plugin_conf, ctx)
89,91c81,82
<                 core.table.insert(errors, auth_plugin_name ..
<                         " failed to authenticate the request, code: "
<                         .. auth_code .. ". error: " .. err)
---
>                 core.log.debug(auth_plugin_name .. " failed to authenticate the request, code: "
>                         .. auth_code)
98,100d88
<         for _, error in ipairs(errors) do
<             core.log.warn(error)
<         end
