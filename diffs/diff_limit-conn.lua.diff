17,18c17,21
< local core = require("apisix.core")
< local limit_conn = require("apisix.plugins.limit-conn.init")
---
> local core                              = require("apisix.core")
> local limit_conn                        = require("apisix.plugins.limit-conn.init")
> local redis_schema                      = require("apisix.utils.redis-schema")
> local policy_to_additional_properties   = redis_schema.schema
> local plugin_name                       = "limit-conn"
21c24
< local plugin_name = "limit-conn"
---
> 
25c28
<         conn = {type = "integer", exclusiveMinimum = 0},
---
>         conn = {type = "integer", exclusiveMinimum = 0},               -- limit.conn max
33a37,41
>         policy = {
>             type = "string",
>             enum = {"redis", "redis-cluster", "local"},
>             default = "local",
>         },
42c50,68
<     required = {"conn", "burst", "default_conn_delay", "key"}
---
>     required = {"conn", "burst", "default_conn_delay", "key"},
>     ["if"] = {
>         properties = {
>             policy = {
>                 enum = {"redis"},
>             },
>         },
>     },
>     ["then"] = policy_to_additional_properties.redis,
>     ["else"] = {
>         ["if"] = {
>             properties = {
>                 policy = {
>                     enum = {"redis-cluster"},
>                 },
>             },
>         },
>         ["then"] = policy_to_additional_properties["redis-cluster"],
>     }
