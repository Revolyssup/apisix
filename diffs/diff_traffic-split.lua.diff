175a176
>         scheme = upstream_info.scheme
193c194,196
< 
---
>     if upstream_info.scheme == "https" then
>         upstream.set_scheme(ctx, up_conf)
>     end
235a239,252
>         -- check if all upstream_ids are valid
>         if rule.weighted_upstreams then
>             for _, wupstream in ipairs(rule.weighted_upstreams) do
>                 local ups_id = wupstream.upstream_id
>                 if ups_id then
>                     local ups = upstream.get_by_id(ups_id)
>                     if not ups then
>                         return 500, "failed to fetch upstream info by "
>                                     .. "upstream id: " .. ups_id
>                     end
>                 end
>             end
>         end
> 
